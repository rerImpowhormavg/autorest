@using System
@using System.Linq;
@using Microsoft.Rest.Generator.ClientModel
@using Microsoft.Rest.Generator.Utilities
@using Microsoft.Rest.Generator.Python
@using Microsoft.Rest.Generator.Python.TemplateModels
@using Microsoft.Rest.Generator.Python.Templates
@inherits Microsoft.Rest.Generator.Template<Microsoft.Rest.Generator.Python.MethodTemplateModel>
    def @(Model.Name.ToPythonCase())(self, @(Model.MethodParameterDeclaration(true))):
        """
@if (!String.IsNullOrEmpty(Model.Summary))
{
@:        @WrapComment(string.Empty, Model.Summary)
}
@if (!String.IsNullOrEmpty(Model.Description))
{
@EmptyLine
@:        @WrapComment(string.Empty, Model.Description)
}
        """
@EmptyLine
@if (Model.ParameterTemplateModels.Any())
{
  var validationBlock = Model.ValidationString;
  if (!string.IsNullOrWhiteSpace(validationBlock))
  {
@:        # Validate
@:        @(validationBlock)
@EmptyLine
  }
}
        try:
    @*if (Model.IsAbsoluteUrl) *@
            # Construct URL
@if (Model.IsAbsoluteUrl)
{
@:            url = '@(Model.Url)'
}
else
{
@:            url = @(Model.ClientReference).baseUri + '@(Model.Url)'
}
            @(Model.BuildUrlPath("url"))
@EmptyLine
            # Construct parameters
            query = {}
            @(Model.BuildUrlQuery("query"))
@EmptyLine
            # Construct headers
            headers = {}
            @(Model.BuildHeaders("query"))
            if customHeaders is not None:
                headers.update(customHeaders)
            headers['Content-Type'] = '@(Model.ContentType)'
@* Add Credentials *@
@EmptyLine
@if (Model.RequestBody != null)
{
@:            # Construct body
@:            content = Serialized(@Model.RequestBody.Name)
@EmptyLine
}
@*stream handler*@
            # Construct and send request
            request = self._client.@(Model.GetHttpFunction(Model.HttpMethod))(url, query)
@if (Model.RequestBody != null)
{
@:            response = self._send(request, headers, content)
}
else
{
@:            response = self._send(request, headers)
}
@EmptyLine
            if response.status_code not in [@Model.GetAcceptStatus()]:
@EmptyLine
                deserialize = Deserialized(BatchStatusError, response, self)
                deserialized = deserialize(response.content, self._classes)
                raise deserialized
@EmptyLine
            return response
@EmptyLine
        except (SerializationError, DeserializationError):
            raise #TODO: Wrap in client-specific error?    
@EmptyLine
