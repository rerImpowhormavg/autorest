@using Microsoft.Rest.Generator.Java
@using Microsoft.Rest.Generator.Java.Templates
@using Microsoft.Rest.Generator.Utilities
@using System.Linq;
@inherits Microsoft.Rest.Generator.Template<Microsoft.Rest.Generator.Java.MethodGroupTemplateModel>
@Header("// ")
@EmptyLine

package @(Settings.Namespace.ToLower());
@EmptyLine
import com.google.gson.reflect.TypeToken;
import com.microsoft.rest.ServiceCallback;
import com.microsoft.rest.ServiceException;
import com.microsoft.rest.ServiceResponse;
import com.microsoft.rest.ServiceResponseBuilder;
import com.microsoft.rest.ServiceResponseCallback;
import retrofit.client.Response;
import retrofit.RestAdapter;
import retrofit.RetrofitError;
@foreach (var importClass in Model.Imports)
{
@:import @importClass;
}
@EmptyLine

public class @Model.MethodGroupType {
    private @Model.MethodGroupServiceType service;
    @EmptyLine
    public @(Model.MethodGroupType)(RestAdapter restAdapter) {
        service = restAdapter.create(@(Model.MethodGroupServiceType).class);
    }
    @EmptyLine

    public interface @Model.MethodGroupServiceType {
    @foreach (var method in Model.MethodTemplateModels)
    {
    @:    @@@(method.HttpMethod.ToString().ToUpper())("@(method.Url)")
    @:    Response @(method.Name)(@method.MethodParameterApiDeclaration) throws ServiceException;
    @EmptyLine
    @:    @@@(method.HttpMethod.ToString().ToUpper())("@(method.Url)")
    @:    void @(method.Name)Async(@method.MethodParameterApiDeclarationWithCallback);
    @EmptyLine
    }
    }

    @foreach (var method in Model.MethodTemplateModels)
    {
    @:public @method.ReturnTypeString @(method.Name)(@method.MethodParameterDeclaration) throws ServiceException {
    if (method.ReturnType != null)
    {
    @:    try {
    @:        return @(method.Name)Delegate(service.@(method.Name)(@method.MethodParameterInvocation), null).getBody();
    @:    } catch (RetrofitError error) {
    @:        return @(method.Name)Delegate(error.getResponse(), error).getBody();
    @:    }
    }
    else
    {
    @:    try {
    @:        @(method.Name)Delegate(service.@(method.Name)(@method.MethodParameterInvocation), null).getBody();
    @:    } catch (RetrofitError error) {
    @:        @(method.Name)Delegate(error.getResponse(), error).getBody();
    @:    }
    }
    @:}
    @EmptyLine
    @:public void @(method.Name)Async(@method.MethodParameterDeclarationWithCallback) {
    @:    service.@(method.Name)Async(@method.MethodParameterInvocationWithCallback {
    @:        @@Override
    @:        public void response(Response response, RetrofitError error) {
    @:            try {
    @:                serviceCallback.success(@(method.Name)Delegate(response, error));
    @:            } catch (ServiceException exception) {
    @:                serviceCallback.failure(exception);
    @:            }
    @:        }
    @:    });
    @:}
    @EmptyLine
    @:private ServiceResponse<@method.GenericReturnTypeString> @(method.Name)Delegate(Response response, RetrofitError error) throws ServiceException {
    @:    return new ServiceResponseBuilder<@method.GenericReturnTypeString>()
                foreach (var response in method.Responses)
                {
                @:.register(@((int)response.Key), new TypeToken<@JavaCodeNamer.NormalizeGenericType(response.Value).Name>(){}.getType())
                }
                if (method.DefaultResponse != null)
                {
                @:.registerError(new TypeToken<@(JavaCodeNamer.NormalizeGenericType(method.DefaultResponse).Name)>(){}.getType())
                }
                @:.build(response, error);
    @:}
    @EmptyLine
    }
}

